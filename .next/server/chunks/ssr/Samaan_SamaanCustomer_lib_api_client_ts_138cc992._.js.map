{"version":3,"sources":["../../../../../../Samaan/SamaanCustomer/lib/api/client.ts"],"sourcesContent":["// API Client for .NET Backend\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:7289/api\"\r\n\r\n// Token management\r\nexport const getToken = (): string | null => {\r\n  if (typeof window === \"undefined\") return null\r\n  return localStorage.getItem(\"authToken\")\r\n}\r\n\r\nexport const setToken = (token: string): void => {\r\n  if (typeof window !== \"undefined\") {\r\n    localStorage.setItem(\"authToken\", token)\r\n  }\r\n}\r\n\r\nexport const removeToken = (): void => {\r\n  if (typeof window !== \"undefined\") {\r\n    localStorage.removeItem(\"authToken\")\r\n    localStorage.removeItem(\"user\")\r\n  }\r\n}\r\n\r\nexport const getUser = () => {\r\n  if (typeof window === \"undefined\") return null\r\n  const user = localStorage.getItem(\"user\")\r\n  return user ? JSON.parse(user) : null\r\n}\r\n\r\nexport const setUser = (user: any): void => {\r\n  if (typeof window !== \"undefined\") {\r\n    localStorage.setItem(\"user\", JSON.stringify(user))\r\n  }\r\n}\r\n\r\n// API fetch wrapper\r\nasync function fetchAPI(endpoint: string, options: RequestInit = {}) {\r\n  const token = getToken()\r\n\r\n  const headers: HeadersInit = {\r\n    \"Content-Type\": \"application/json\",\r\n    ...options.headers,\r\n  }\r\n\r\n  if (token) {\r\n    ;(headers as Record<string, string>)[\"Authorization\"] = `Bearer ${token}`\r\n  }\r\n\r\n  const url = `${API_BASE_URL}${endpoint}`\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      ...options,\r\n      headers,\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text()\r\n      let errorMessage = \"Request failed\"\r\n      try {\r\n        const errorJson = JSON.parse(errorText)\r\n        errorMessage = errorJson.message || errorJson.title || errorJson.error || errorMessage\r\n      } catch {\r\n        errorMessage = errorText || errorMessage\r\n      }\r\n      throw new Error(errorMessage)\r\n    }\r\n\r\n    const data = await response.json()\r\n    return data\r\n  } catch (error) {\r\n    console.error(\"API Error:\", error)\r\n    throw error\r\n  }\r\n}\r\n\r\n// Auth API\r\nexport const authAPI = {\r\n  login: async (email: string, password: string) => {\r\n    const response = await fetchAPI(\"/Auth/login\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ email, password }),\r\n    })\r\n\r\n    if (response.success && response.token) {\r\n      setToken(response.token)\r\n      setUser(response.user)\r\n    }\r\n\r\n    return response\r\n  },\r\n\r\n  register: async (data: {\r\n    email: string\r\n    password: string\r\n    fullName: string\r\n    phone?: string\r\n    role: string\r\n  }) => {\r\n    const response = await fetchAPI(\"/Auth/register\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n    })\r\n\r\n    if (response.success && response.token) {\r\n      setToken(response.token)\r\n      setUser(response.user)\r\n    }\r\n\r\n    return response\r\n  },\r\n\r\n  logout: () => {\r\n    removeToken()\r\n  },\r\n\r\n  isAuthenticated: () => {\r\n    return !!getToken()\r\n  },\r\n\r\n  getCurrentUser: () => {\r\n    return getUser()\r\n  },\r\n\r\n  googleLogin: async (idToken: string) => {\r\n    const response = await fetchAPI(\"/Auth/google\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({ idToken }),\r\n    })\r\n\r\n    if (response.success && response.token) {\r\n      setToken(response.token)\r\n      setUser(response.user)\r\n    }\r\n\r\n    return response\r\n  },\r\n}\r\n\r\n// Products API\r\nexport const productsAPI = {\r\n  getAll: () => fetchAPI(\"/Products\"),\r\n  getById: (id: string) => fetchAPI(`/Products/${id}`),\r\n  getByMerchant: (merchantId: string) => fetchAPI(`/Products/merchant/${merchantId}`),\r\n  search: (query: string) => fetchAPI(`/Products/search?q=${encodeURIComponent(query)}`),\r\n  getByCategory: (category: string) => fetchAPI(`/Products/category/${encodeURIComponent(category)}`),\r\n}\r\n\r\n// Merchants API\r\nexport const merchantsAPI = {\r\n  getAll: () => fetchAPI(\"/Merchants\"),\r\n  getById: (id: string) => fetchAPI(`/Merchants/${id}`),\r\n  getProducts: (id: string) => fetchAPI(`/Merchants/${id}/products`),\r\n  getNearby: (city: string) => fetchAPI(`/Merchants/nearby?city=${encodeURIComponent(city)}`),\r\n}\r\n\r\n// Orders API\r\nexport const ordersAPI = {\r\n  getMyOrders: () => fetchAPI(\"/Orders\"),\r\n  getById: (id: string) => fetchAPI(`/Orders/${id}`),\r\n  create: (order: {\r\n    merchantId: string\r\n    itemsTotal: number\r\n    deliveryFee?: number\r\n    discount?: number\r\n    paymentMethod?: string\r\n    deliveryAddress?: string\r\n    deliveryInstructions?: string\r\n    items: Array<{ productId: string; quantity: number }>\r\n  }) =>\r\n    fetchAPI(\"/Orders\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(order),\r\n    }),\r\n}\r\n\r\nexport const api = {\r\n  auth: authAPI,\r\n  products: productsAPI,\r\n  merchants: merchantsAPI,\r\n  orders: ordersAPI,\r\n}\r\n"],"names":[],"mappings":"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"}